\section{Résolution des équations intégrales avec CIOE par la méthode des éléments finis de frontières}

  \newcommand{\phij}{\vect{\phi_j}}

  Les équations intégrales sont des méthodes bien éprouvées pour résoudre les équations de Maxwell, tel que l'a démontré \cite{nedelec_acoustic_2001}. Ce chapitre rappelle quelques résultats connus et montre la contribution des \gls{acr-cioe}.

  Les équations intégrales sont résolues grâce à la méthode des éléments finis de frontière.

  \subsection[Espace fonctionnel Hdiv]{Espace fonctionnel \(\Hdiv\)}
    On définit l'espace \(\Hdiv(\Gamma_h)\) tel que
    \begin{defn}
      Pour toute fonction \(\vect{U}(\vx) \in \Hdiv(\Gamma_h), \vdivs\vect{U}(\vx) \in L^2(\Gamma_h)\)
    \end{defn}

  \subsection{Équations intégrales}

      Soit \(g\) la fonction de Green. Soit \(\vE^{inc}_t,\vH^{inc}_t\) le champ incident tangentiel à \(\Gamma_h\). On définit le long de la surface \(\Gamma_h\), les traces tangentielles des champs \(\vJ = \vn \pvect \vH\), \(\vK = \vn \pvect \vE\).

      \subsubsection{EFIE}

        \begin{defn}
          \(\vJ,\vK\) sont solutions des équations intégrales en champ électrique (\gls{acr-efie}) si il existe \((\vJ,\vK) \in \Hdiv(\Gamma_h)^2\) tels que
          \begin{multline}
            \label{eq:form_int:EFIE}
            \vE^{inc}_t(\vx) =
              \frac{\vE_t(\vx)}{2}
                - \int_{\Gamma_h} \vgrad g(\vx - \vy) \pvect \vK(\vy) \dd{s}(\vy) \cdots \\
              + \frac{i}{k}\vgrad \int_{\Gamma_h}  g(\vx - \vy)\vdiv\vJ(\vy)(\vx) \dd{s}(\vy)
                +  ik\int_{\Gamma_h} g(\vx - \vy)\vJ(\vy) \dd{s}(\vy)
          \end{multline}
        \end{defn}

        \begin{REF}
          Mettre source de l'EFIE (Nédélec, p243 - 253)
        \end{REF}

      \subsubsection{MFIE}

        \begin{defn}
          \(\vJ,\vK\) sont solutions des équations intégrales en champ magnétique (\gls{acr-mfie}) si il existe \((\vJ,\vK) \in \Hdiv(\Gamma_h)^2\) tels que
          \begin{multline}
            \label{eq:form_int:MFIE}
            \vH^{inc}(\vx) =
            \frac{\vH_t(\vx)}{2}
              - \int_{\Gamma_h} \vgrad g(\vx - \vy) \pvect \vJ(\vy) \dd{s}(\vy) \cdots \\
            - \frac{i}{k} \vgrad \int_{\Gamma_h}  g(\vx - \vy)\vdiv\vK(\vy)\dd{s}(\vy)
              - ik \int_{\Gamma_h} g(\vx - \vy)\vK(\vy)\dd{s}(\vy)
          \end{multline}
        \end{defn}

        \begin{REF}
          Mettre source de la MFIE (Nédélec, p243 - 253)
        \end{REF}

  \subsection{Discrétisation de la surface de l'objet}

    Soit \(\OO_h\) un maillage fermé de \(\OO\) en \(N_e\) éléments triangulaires. Soit \(N\) le nombre d'arête du maillage. On désigne par \(\vn\) la normale unitaire sortante du maillage, non défini aux nœuds et arêtes du maillage.

    Soit \(\uj\) une arête orientée commune aux triangles \(T_j^g\) (orientation directe) et \(T_j^d\) (orientation indirecte). Dans cette convention d'orientation. Cette arête défini \(\vect{\tau_j}\), le vecteur unitaire le long de l'arête. De part et d'autre de cette dernière on définit \(\vect{\nu_j}^{g/d} = \vect{\tau_j} \pvect \vn^{g/d} \), le vecteur unitaire sortant du triangle \(T_j^g\) vers \(T_j^d\).  De plus on définit les vecteurs suivants:
    \begin{align}
      \vect{v_j^{g/d}} &= \vect{a_j^b} - \vect{a_j^{g/d}} \\
      \vect{w_j^{g/d}} &= \vect{a_j^h} - \vect{a_j^{g/d}}
    \end{align}

    % Les commandes qui suivent servent pour les 4 prochains schémas
    \newcommand{\ncouche}{6}
    \newcommand{\xa}{-0.2}
    \newcommand{\ya}{0.0}
    \newcommand{\xb}{3}
    \newcommand{\yb}{0.3}
    \newcommand{\xc}{0.4}
    \newcommand{\yc}{4}
    \newcommand{\xd}{4}
    \newcommand{\yd}{3.4}

    \begin{minipage}{0.45\textwidth}
      \begin{center}
        \begin{tikzpicture}[scale=1]
          \input{tikz/schema/fonbasloc_triangles.tikz}
        \end{tikzpicture}
      \end{center}
      \captionof{figure}{Triangles, arêtes et nœuds définis par l'arête \(\uj\)}
      \label{fig:form_int:fon_base:tri}
    \end{minipage}
    \begin{minipage}{0.54\textwidth}
      Dans la suite, on représente ces éléments dans le même plan tel que ci-contre, mais on note qu'en général, ils ne le sont pas (voir \cite[fig.~2]{rao_electromagnetic_1982}).\\

      En coordonnées locales, \(\vx = (\xi_1,\xi_2) \in \lbrace (\xi_1,\xi_2) \in [0,1]^2, \xi_1 + \xi_2 \le 1\rbrace\),
      En coordonnées globales, \(\vx = (x_1,x_2,x_3) \in \Gamma_h\),

      Le passage de l'un à l'autre se fait grâce aux relations:
      \begin{align}
        \xi_1 &= \left(\vect{x} - \vect{a_j}^{g/d} \right) \cdot \frac{\vect{e_2}}{||\vect{e_2}||^2}
        \\
        \xi_2 &= \left(\vect{x} - \vect{a_j}^{g/d} \right) \cdot \frac{\vect{e_3}}{||\vect{e_3}||^2}
        \\
        \vx &= \vect{a_j^{g/d}}+ \xi_1 \vect{v_j^{g/d}} + \xi_2 \vect{w_j^{g/d}}
      \end{align}
    \end{minipage}

    \subsubsection[Fonctions de Raviart-Thomas phi Hdiv-conforme]{Fonctions de Raviart-Thomas \(\vect{\phi}\) \(\Hdiv\)-conforme}

      Ces fonctions ont été introduites par \cite{raviart_mixed_1977,rao_electromagnetic_1982}.

      \begin{minipage}{0.45\textwidth}
          \begin{center}
            \begin{tikzpicture}[scale=1]
              \input{tikz/schema/fonbasloc_phi.tikz}
            \end{tikzpicture}
          \end{center}
          \captionof{figure}{Fonction de base \(\phij\)}
          \label{fig:form_int:fon_base:phi}
      \end{minipage}
      \begin{minipage}{0.54\textwidth}
        En coordonnées locales au triangle \(T_j^{g/d}\),
        \begin{align*}
         \phij(\vx) &= \frac{\epsilon^{g/d}}{2|T_j^{g/d}|}\left(\xi_1 \vect{v_j^{g/d}} + \xi_2 \vect{w_j^{g/d}}\right)
        \end{align*}

        En coordonnées globales,
        \begin{align*}
          \phij(\vx) &= \mathbf{1}_{T_j^g}(\vx)\frac{\vx-\vect{a_j^g}}{2|T_j^g|} - \mathbf{1}_{T_j^d}(\vx)\frac{\vx-\vect{a_j^d}}{2|T_j^d|}
        \end{align*}
      \end{minipage}

      \begin{prop}
        Les fonctions \(\phij\) sont dans \(\Hdiv(\Gamma_h)\)
      \end{prop}
      \begin{proof}
        Nous renvoyons au travail de \cite{nedelec_mixed_1980} (voir Annexe prop.~\ref{prop:annex:hdiv_hrot:hdiv}).
      \end{proof}

      \begin{defn}
        Pour tout \(\vect{U} \in \Hdiv(\Gamma_h)\), alors 
        \begin{equation*}
          \vect{U} \in \Vect{\vect{\phi_1},\ldots,\vect{\phi_N}} \Leftrightarrow \exists \comp{u} = (u_1,\cdots,u_N)^t \in \RR^N, \vect{U}(\vx) = \sum_{j=1}^N u_j \phij(\vx)
        \end{equation*}
      \end{defn}
  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

  \subsection{Fonctions de projections}

    \subsubsection[Fonctions de Nédélec p Hrot-conforme]{Fonctions de Nédelec \(\vect{p}\) \(\Hrot\)-conforme}

      \begin{minipage}{0.45\textwidth}
        \begin{center}
          \begin{tikzpicture}[scale=1]
            \input{tikz/schema/fonbasloc_p.tikz}
          \end{tikzpicture}
        \end{center}
        \captionof{figure}{Fonction de base \(\pj\)}
        \label{fig:form_int:fon_base:p}
      \end{minipage}
      \begin{minipage}{0.54\textwidth}
        En coordonnées locales au triangle \(T_j^{g/d}\),
        \begin{align*}
          \pj(\vx) &= \frac{\epsilon^{g/d}}{2|T_j^{g/d}|}\left(\xi_2 \vect{v_j^{g/d}}-\xi_1 \vect{w_j^{g/d}}\right)
        \end{align*}

        En coordonnées globales,
        \begin{align*}
          \pj(\vx)
          &= -\mathbf{1}_{T_j^g}(\vx)\vect{n^g} \pvect \frac{\vx-\vect{a_j^g}}{2|T_j^g|} \\
          & + \mathbf{1}_{T_j^d}(\vx)\vect{n^d} \pvect \frac{\vx-\vect{a_j^d}}{2|T_j^d|}
        \end{align*}
      \end{minipage}

      \begin{prop}
        Les fonctions \(\pj\) sont dans \(\Hrot(\Gamma_h)\)
      \end{prop}
      \begin{proof}
        Nous renvoyons au travail de \cite{nedelec_mixed_1980} (voir Annexe prop.~\ref{prop:annex:hdiv_hrot:hrot}).
      \end{proof}


      \begin{defn}
        Pour tout \(\vect{V} \in \Hrot(\Gamma_h)\), alors 
        \begin{equation*}
          \vect{V} \in \Vect{\vect{p_1},\ldots,\vect{p_N}} \Leftrightarrow \exists \comp{v} = (v_1,\cdots,v_N)^t \in \RR^N, \vect{V}(\vx) = \sum_{j=1}^N v_j \pj(\vx)
        \end{equation*}
      \end{defn}

    \subsubsection[Fonctions de Bendali q]{Fonctions de Bendali \(\vect{q}\)}

      Ces fonctions ont été introduites par \cite[eq.~28]{bendali_boundary-element_1999}.

      \begin{minipage}{0.45\textwidth}
        \begin{center}
          \begin{tikzpicture}[scale=1]
            \input{tikz/schema/fonbasloc_q.tikz}
          \end{tikzpicture}
        \end{center}
          \captionof{figure}{Fonction de base \(\qj\)}
          \label{fig:form_int:fon_base:q}
      \end{minipage}
      \begin{minipage}{0.54\textwidth}
        En coordonnées locales au triangle \(T_j^{g/d}\),
        \begin{align*}
          \qj(\vx) &= \left(1-2(\xi_1+\xi_2)\right)\left(\vect{w_j}^{g/d} - \vect{v_j}^{g/d} \right)
        \end{align*}

        En coordonnées globales,
        \begin{align*}
          \qj(\vx)
          &= - \frac{\mathbf{1}_{T_j^g}(\vx)}{2} \frac{\nuj\cdot\left(2\vx - {\vect{a_j^g} + \vect{a_j^t}}\right)}{\nuj\cdot \vect{w_j^g}} \uj \\
          &- \frac{\mathbf{1}_{T_j^d}(\vx)}{2} \frac{\nuj\cdot\left(2\vx - {\vect{a_j^d} + \vect{a_j^t}}\right)}{\nuj\cdot\vect{w_j^d}}\uj
        \end{align*}
      \end{minipage}

      \begin{prop}
        Les fonctions \(\qj\) ne sont pas dans \(\Hrot\)
      \end{prop}
      \begin{proof}
        La composante de la fonction le long des arêtes extérieurs des 2 triangles n'est pas nulle.
      \end{proof}

      \begin{prop}
        Les fonctions \(\qj\) forment un base de \(L^2(\Gamma_h)\)
      \end{prop}
      \begin{proof}
        Les fonctions \(\qj\) sont linéairement indépendantes, et la famille est de taille N.
      \end{proof}

      \begin{defn}
        Pour tout \(\vect{W} \in L^2(\Gamma_h)\), alors 
        \begin{equation*}
          \vect{W} \in \Vect{\vect{q_1},\ldots,\vect{q_N}} \Leftrightarrow \exists \comp{w} = (w_1,\cdots,w_N)^t \in \RR^N, \vect{W}(\vx) = \sum_{j=1}^N w_j \qj(\vx)
        \end{equation*}
      \end{defn}

  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

  \subsection{Matrices de projections}

    De ces familles de fonctions, on va définir les produits scalaire associés

    \begin{defn}
      Soient \(f \in \Vect{\vect{f_1},\ldots,\vect{f_N}}\) et \(g \in \Vect{\vect{g_1},\ldots,\vect{g_N}}\), on définit la matrice \(\mG{f}{g}\) telle que
      \begin{equation*}
        \mG{f}{g}_{ij} = \int_{\Gamma_h} \vect{f_i}(\vx)\cdot \vect{g_j}(\vx) \dd{s}(\vx)
      \end{equation*}
    \end{defn}

    % \begin{prop}
    %   Par définition
    %   \begin{equation*}
    %     \left(\mG{f}{g}\right)^t = \mG{g}{f}
    %   \end{equation*}
    % \end{prop}

    \begin{prop}
      \begin{equation*}
        \mG{\phi}{\phi} = \mG{p}{p}
      \end{equation*}
    \end{prop}

    % \begin{prop}
    %   \(\mG{p}{\phi}\) est anti-symétrique
    % \end{prop}

    \begin{proof}
      C'est un conséquence immédiate du produit triangulaire et que les fonctions de bases soient tangentes à la surface..
      \[
        \begin{aligned}
          a\cdot (b \pvect c) &= c\cdot (a \pvect b) 
          \\
          \pj \cdot \pii &= (\vn \pvect \phij) \cdot ( \vn \pvect \phii)
          \\
          &= \phii \cdot ( (\vn \pvect \phij) \pvect \vn) 
          \\
          &= \phii \cdot \phij
        \end{aligned}
      \]
    \end{proof}

    \begin{defn}
      On désigne par \(\mM\) la matrice \(\mG{\phi}{\phi} = \mG{p}{p}\).
    \end{defn}

    % Soit  \(\vect{W}(\vx) = \sum_{j=1}^N w_j \qj(\vx) \in L^2(\Gamma_h)\).

    % Soit \(\vect{U}(\vx) = \sum_{j=1}^N u_j \phij(\vx) = \sum_{j=1}^N \int_{\Gamma_h}\vect{W}(\vy)\cdot\phij(\vy)\dd{s}(\vy) \phij(\vx) \)

    % Alors on a \(\comp{u} = \mG{\phi}{q}\comp{w}\) les composantes des \(\qj\) projetés sur les  \(\phij\).

    Soit  \(\vect{W}(\vx) = \sum_{j=1}^N w_j \qj(\vx) \in L^2(\Gamma_h)\).

    On définit alors deux éléments de \(L^2(\Gamma_h)\) :
    \begin{align}
      \vect{U}(\vx) &= \sum_{j=1}^N u_j \phij(\vx) = \sum_{j=1}^N \int_{\Gamma_h}\vect{W}(\vy)\cdot\phij(\vy)\dd{s}(\vy) \phij(\vx  )
      \\
      \vect{V}(\vx) &= \sum_{j=1}^N v_j \pj(\vx) = \sum_{j=1}^N \int_{\Gamma_h}\vect{W}(\vy)\cdot\pj(\vy)\dd{s}(\vy) \pj(\vx)
    \end{align}

    
    On définit alors la projection des \(\qj\) sur les \(\phij\) telle que
    \begin{prop}
      Pour toute fonction \(\vect{W}(\vx) \in L^2(\Gamma_h)\cap\Vect{(\qj)_j}\),

      il existe \(\vect{U}(\vx) \in L^2(\Gamma_h) \cap \Vect{(\phij)_j} \) telle que
      \begin{equation*}
        \comp{u} = \mG{\phi}{q}\comp{w}
      \end{equation*}
    \end{prop}

    On définit alors la projection des \(\qj\) sur les \(\pj\) telle que
    \begin{prop}
      Pour toute fonction \(\vect{W}(\vx) \in L^2(\Gamma_h)\cap\Vect{(\qj)_j}\),

      il existe \(\vect{V}(\vx) \in L^2(\Gamma_h) \cap \Vect{(\pj)_j} \) telle que
      \begin{equation*}
        \comp{v} = \mG{p}{q}\comp{w}
      \end{equation*}
    \end{prop}

  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

  \subsection{Matrice de changement de base}

    \begin{defn}
      On définit alors le changement de la base qui permet de passer de \(\vect{u}\) à \(\vect{v}\)
      \begin{equation*}
        \mP{\phi}{p}{q} = \left(\mG{q}{\phi}\right)^{-1}\mG{q}{p}
      \end{equation*}
    \end{defn}

    % \begin{prop}
    %   \begin{equation*}
    %     \left(\mP{u}{v}{w}\right)^t = \mG{v}{w}\left(\mG{u}{w}\right)^{-1}
    %   \end{equation*}
    % \end{prop}

    % \begin{prop}
    %   On suppose de plus que la matrice \(\mG{w}{v}\) est inversible alors
    %   \begin{equation*}
    %     \left(\mP{u}{v}{w}\right)^{-1} = \mP{v}{u}{w}
    %   \end{equation*}
    % \end{prop}

    % \begin{prop}
    %   Soit \(\vect{U}(\vx) \simeq \sum u_j \phij(\vx) \simeq \sum v_j \pj(\vx)\)
    %   \begin{align}
    %     \vect{u} & \simeq \mP{\phi}{p}{p} \vect{v} & \text{projection sur } \pj \\
    %     \vect{u} & \simeq \mP{\phi}{p}{q} \vect{v} & \text{projection sur } \qj
    %   \end{align}
    % \end{prop}

    \begin{defn}
      On désigne par \(\mPP\) la matrice \(\mP{\phi}{p}{q}\).
    \end{defn}



  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

  

  \subsection{Forme variationnelle des équations intégrales}
    Étant donné \((k,\vE^{inc},\vH^{inc})\) on cherche \(\vJ = \vn \pvect \vH, \vK = \vn \pvect \vE\) tel que

    Pour tout \(\vect{\phi} \in \Hdiv(\Gamma_h)\), on a

    \begin{multline}
      \label{eq:form_int:EFIE:var}
      \int_{\Gamma_h} \vE^{inc}_t(\vx) \cdot \vect{\phi}(\vx) \dd{s}(\vx) =
        \frac{1}{2} \int_{\Gamma_h} \vE_t(\vx) \cdot \vect{\phi}(\vx) \dd{s}(\vx) \\
          - \int_{\Gamma_h} \left( \int_{\Gamma_h} \vgrad g(\vx - \vy) \pvect \vK(\vy) \dd{s}(\vy) \right) \cdot \vect{\phi}(\vx) \dd{s}(\vx) \\
        - \frac{i}{k} \int_{\Gamma_h} \left( \int_{\Gamma_h}  g(\vx - \vy)\tdivs\vJ(\vy) \dd{s}(\vy) \right) \cdot \tdivs \vect{\phi}(\vx) \dd{s}(\vx) \\
          +  ik\int_{\Gamma_h} \left( \int_{\Gamma_h} g(\vx - \vy)\vJ(\vy) \dd{s}(\vy) \right) \cdot \vect{\phi}(\vx) \dd{s}(\vx)
    \end{multline}
    \begin{multline}
      \label{eq:form_int:MFIE:var}
      \int_{\Gamma_h} \vH^{inc}_t(\vx) \cdot \vect{\phi}(\vx) \dd{s}(\vx) =
        \frac{1}{2} \int_{\Gamma_h} \vH_t(\vx) \cdot \vect{\phi}(\vx) \dd{s}(\vx) \\
          - \int_{\Gamma_h} \left( \int_{\Gamma_h} \vgrad g(\vx - \vy) \pvect \vJ(\vy) \dd{s}(\vy) \right) \cdot \vect{\phi}(\vx) \dd{s}(\vx) \\
        + \frac{i}{k} \int_{\Gamma_h} \left( \int_{\Gamma_h}  g(\vx - \vy)\tdivs\vK(\vy) \dd{s}(\vy) \right) \cdot \tdivs \vect{\phi}(\vx) \dd{s}(\vx) \\
          -  ik\int_{\Gamma_h} \left( \int_{\Gamma_h} g(\vx - \vy)\vK(\vy) \dd{s}(\vy) \right) \cdot \vect{\phi}(\vx) \dd{s}(\vx)
    \end{multline}

  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

  \subsection{Contribution de la CIOE dans la discrétisation de la forme variationnelle}


    On prend comme fonction test \(\phii\), la fonction de base associée à l'arête \(j\).
    On décompose \(\vJ,\vK\) sur les fonctions de base \(\phij\):
    \begin{subequations}
      \begin{align}
        \vJ &\simeq \sum_{j=1}^N I_j \phij\\
        \vK &\simeq \sum_{j=1}^N k_j \phij
      \end{align}
    \end{subequations}

    \subsubsection[Discrétisation des opérateurs LD, LR]{Discrétisation des opérateurs \(\LD,\LR\)}
      Les CIOE font intervenir les opérateurs différentiels \gls{ope-LD}, \gls{ope-LR}, \gls{ope-L}. On introduit donc les matrices \(\mLD,\mLR,\mL\) correspondantes.

      Comme les \(\phij\) sont dans \(\Hdiv\), de l'opérateur \gls{ope-LD}, on définit la matrice \(\mLD\) :
      \begin{align}
        \int_{\Gamma_h} L_D(\vect{U})(\vx) \cdot \phii(\vx) \dd{s}(\vx)
          & \simeq - \sum_{j=1}^N u_j \int_{\Gamma_h} \vdiv \phij(\vx) \vdiv \phii(\vx) \dd{s}(\vx) \\
          & = \mLD \vu
      \end{align}

      Par définition des fonctions \(\phij\), leur rotationnel est nul à l'intérieur et non défini sur les bords. On projette alors les fonctions \(\phij\) sur les fonctions \(\pj\) grâce aux \(\qj\) \footnote{On peut aussi projeter grâce aux \(\pj\), voir annexe}.

      \begin{prop}
        \begin{align}
          \mLR & = -\mPP^t\mLD\mPP
        \end{align}
      \end{prop}
      \begin{proof}
        Cette propriété est démontré par \cite[eq.~(13)]{stupfel_implementation_2015}).
        \begin{equation}
          \begin{aligned}
            \int_{\Gamma_h} L_R (\phij) (\vx) \cdot \phii(\vx) \dd{s}(\vx) & \simeq \sum_{p=1}^{N} \sum_{q=1}^{N} \int_{\Gamma_h} c_q^j c_p^i L_R (\vn \pvect \phiq) (\vx) \cdot (\vn \pvect \phip)(\vx) \dd{s}(\vx)
            \\
            & \simeq -\sum_{p=1}^{N} \sum_{q=1}^{N} c_q^j c_p^i \int_{\Gamma_h} L_D (\phiq) (\vx) \cdot (\phip)(\vx) \dd{s}(\vx)
            % \\
            % & \simeq \sum_{p=1}^{N} c_p^i \sum_{q=1}^{N} c_q^j \mLD_{qp}
            % \\
            % & \simeq \sum_{p=1}^{N} c_p^i \left( \mLD \vect{c^j} \right)_{p}
            % \\
            % & \simeq \vect{c^i}^t  \mLD \vect{c^j}
            \\
            & \simeq -\vect{\delta_i}^t \mPP^t \mLD \mPP \vect{\delta_j}
          \end{aligned}
        \end{equation}
      \end{proof}

    \subsubsection{Contribution de la CIOE à l'EFIE}

      \begin{equation}
        \begin{aligned}
          \frac{1}{2} \int_{\Gamma_h} \vE_t(\vx) \cdot \phii(\vx) \dd{s}(\vx)
          &= \frac{1}{2} \int_{\Gamma_h}  \left( \left(I_d + b_1 L_D - b_2 L_R\right) \vJ (\vx)\right.
          \\
          & \hspace{5em} \left.  - \left( b_1 L_D - b_2 L_R\right) \vE_t (\vx) \right) \cdot \phii(\vx) \dd{s}(\vx)
          \\
          & \simeq \frac{1}{2} \sum_{j=1}^N \int_{\Gamma_h} \left( \left(I_d + b_1 L_D - b_2 L_R\right) I_j \phij (\vx)\right.
          \\
          & \hspace{5em} \left.  - \left( b_1 L_D - b_2 L_R\right) e_j \phij (\vx) \right) \cdot \phii(\vx) \dd{s}(\vx)
          \\
          & = \frac{1}{2} \left( \left(\mG{\phi}{\phi} + b_1 \mLD - b_2 \mLR\right) \vect{I}  - \left( b_1 \mLD - b_2 \mLR\right) \vect{e}\right)
        \end{aligned}
      \end{equation}

      Or comme \(\vK = \vn \pvect \vE\),
      \begin{equation}
        \begin{aligned}
        \sum_{j=1}^N e_j \vn \pvect \phij & \simeq \sum_{j=1}^N k_j \phij
        \\
        \vect{e} \simeq \mPP \vect{k}
        \end{aligned}
      \end{equation}
      Donc la contribution des CIOE à l'EFIE est
      \begin{equation}
        \begin{aligned}
          \frac{1}{2} \int_{\Gamma_h} \vE_t(\vx) \cdot \phii(\vx) \dd{s}(\vx)
          & \simeq \frac{1}{2} \left( \left(\mM + b_1 \mLD - b_2 \mLR\right) \vect{I}  - \left( b_1 \mLD - b_2 \mLR\right) \mPP \vect{m}\right)
        \end{aligned}
      \end{equation}

    \subsubsection{Contribution de la CIOE à la MFIE}

      Pour la MFIE, on commence par remarquer que
      \begin{equation}
        \begin{aligned}
          \frac{1}{2}\int_{\Gamma_h} \vH_t(\vx) \cdot \phii(\vx) \dd{s}(\vx)
          &= \frac{1}{2}\int_{\Gamma_h} \vJ(\vx) \cdot (\vn \pvect \phii)(\vx) \dd{s}(\vx)
          \\
          &= \frac{1}{2a_0}\int_{\Gamma_h} \left( \left(I_d + b_1 L_D - b_2 L_R\right) \vE_t (\vx) \right.
          \\
          & \hspace{5em} \left.- \left(a_1 L_D - a_2 L_R\right) \vJ (\vx) \right) \cdot (\vn \pvect \phii)(\vx) \dd{s}(\vx)
          \\
          &= \frac{1}{2a_0}\int_{\Gamma_h} \left( -\left(I_d + b_1 L_D - b_2 L_R\right) \vn \pvect \vK (\vx) \right.
          \\
          & \hspace{5em} \left.- \left(a_1 L_D - a_2 L_R\right) \vJ (\vx) \right) \cdot (\vn \pvect \phii)(\vx) \dd{s}(\vx)
          \\
          & \simeq \frac{1}{2a_0}\sum_{i=1}^N \int_{\Gamma_h} \left( -\left(I_d + b_1 L_D - b_2 L_R\right) k_j \vn \pvect   \phij (\vx) \right.
          \\
          & \hspace{5em} \left. - \left(a_1 L_D - a_2 L_R\right) I_j' \vn \pvect \phij (\vx) \right) \cdot (\vn \pvect \phii)(\vx) \dd{s}(\vx)
          \\
          & \simeq \frac{1}{2a_0}\sum_{i=1}^N \int_{\Gamma_h} \left( -\left(I_d + b_1 L_R - b_2 L_D\right) k_j \phij (\vx) \right.
          \\
          & \hspace{5em} \left. - \left(a_1 L_R - a_2 L_D\right) I_j' \phij (\vx) \right) \cdot \phii(\vx) \dd{s}(\vx)
          \\
          & = \frac{1}{2a_0} \left( -\left(\mG{\phi}{\phi} + b_1 \mLR - b_2 \mLD\right) \vect{k}  - \left( a_1 \mLR - a_2 \mLD\right) \vect{I'}\right)
          \\
          & \simeq -\frac{1}{2a_0} \left( \left(\mM + b_1 \mLR - b_2 \mLD\right) \vect{k}  + \left( a_1 \mLR - a_2 \mLD\right) \mPP \vect{I} \right)
        \end{aligned}
      \end{equation}
      Donc la contribution des CIOE à la MFIE est
      \begin{equation}
        \begin{aligned}
          \frac{1}{2}\int_{\Gamma_h} \vH_t(\vx) \cdot \phii(\vx) \dd{s}(\vx)
          &\simeq -\frac{1}{2a_0} \left( \left(\mM + b_1 \mLR - b_2 \mLD\right) \vect{k}  + \left( a_1 \mLR - a_2 \mLD\right) \mPP \vect{I} \right)
        \end{aligned}
      \end{equation}

  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

  \subsection{Forme matricielle de la discrétisation de la forme variationnelle des équations intégrales avec condition d'impédance}

    \begin{defn}
      On définit les matrices \(\mS\), \(\mSt\) telles que

      \begin{align}
        S_{pq}
          &= ik \int_{\Gamma_h} \left( \int_{\Gamma_h} g(\vx - \vy) \phip(\vy) \dd{s}(\vy) \right) \cdot \phiq (\vx)\dd{s}(\vx) \cdots\\
          \notag&~+ \frac{i}{k}\int_{\Gamma_h} \left( \int_{\Gamma_h} g(\vx - \vy) \vdiv \phip (\vy) \dd{s}(\vy) \right) \vdiv \phiq(\vx)\dd{s}(\vx)\\
        \tilde{S}_{pq}
          &= \int_{\Gamma_h} \left( \int_{\Gamma_h} \vgrad g(\vx - \vy) \pvect \phip(\vy) \dd{s}(\vy) \right) \cdot \phiq(\vx)\dd{s}(\vx)
      \end{align}
    \end{defn}

    \begin{prop}
      Les matrices \(\mS\) et \(\mSt\) sont symétriques.
    \end{prop}
    \begin{proof}
      C'est une conséquence immédiate des propriétés de l'intégrale et de la parité de la fonction de Green.
    \end{proof}

    Le second membre est obtenu en projetant le champ incident
    \begin{subequations}
      \begin{align}
        b_i^E &= \int_{\Gamma_h} \vE_t^{inc}(\vx) \cdot \phii(\vx)\dd{s}(\vx) \\
        b_i^H &= \int_{\Gamma_h} \vH_t^{inc}(\vx) \cdot \phii(\vx)\dd{s}(\vx)
      \end{align}
    \end{subequations}

    \begin{prop}
      \label{prop:form_int:ci3}
      On cherche \(\vect{I},\vect{k}\) solution de
      \begin{equation*}
        \begin{bmatrix}
          \mS +  \frac{1}{2} \left(a_0 \mM + a_1 \mLD - a_2 \mLR\right) & \mSt + \frac{1}{2}\left(b_1 \mLD - b_2 \mLR \right)\mPP \\
          \mSt + \frac{1}{2a_0}\left( a_2 \mLD - a_1 \mLR \right)\mPP & -\mS - \frac{1}{2a_0}\left(\mM + b_1 \mLR - b_2 \mLD \right)
        \end{bmatrix}
        \begin{bmatrix}
          \vect{I}\\
          \vect{k}
        \end{bmatrix}
        =
        \begin{bmatrix}
          \vect{b^E}\\
          \vect{b^H}
        \end{bmatrix}
      \end{equation*}
    \end{prop}
